=== Phase 2.3: Compiling INT8 Optimized Mel Spectrogram Kernel ===

Step 1: Compiling INT8 optimized kernel to AIE2 ELF with Peano...
  Kernel: mel_int8_optimized.c
  Features:
    - Full INT8 quantization (Q7 format)
    - AIE2 SIMD vectorization
    - Block floating-point FFT
    - Vectorized mel filterbank
    - Log magnitude lookup table

clang++: warning: treating 'c' input as 'c++' when in C++ mode, this behavior is deprecated [-Wdeprecated]
✅ INT8 kernel compiled:
-rw-rw-r-- 1 ucadmin ucadmin 6.8K Oct 27 15:37 /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_optimized.o

Step 2: Lowering MLIR (aie-opt)...
✅ MLIR lowered: /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_lowered.mlir
-rw-rw-r-- 1 ucadmin ucadmin 689 Oct 27 15:37 /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_lowered.mlir

Step 3: Generating CDO files (aie-translate)...
✅ CDO files generated:
-rw-rw-r-- 1 ucadmin ucadmin 204 Oct 27 15:37 main_aie_cdo_elfs.bin
-rw-rw-r-- 1 ucadmin ucadmin  44 Oct 27 15:37 main_aie_cdo_enable.bin
-rw-rw-r-- 1 ucadmin ucadmin 320 Oct 27 15:37 main_aie_cdo_init.bin

Step 4: Combining CDO files for XDNA...
✅ Combined CDO files: /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_cdo_combined.bin
-rw-rw-r-- 1 ucadmin ucadmin 568 Oct 27 15:37 mel_int8_cdo_combined.bin

Step 5: Packaging XCLBIN (xclbinutil)...
XRT Build Version: 2.20.0 (HEAD)
       Build Date: 2025-10-08 06:49:15
          Hash ID: 9b916190ad2865a7e7e497155c66b3b4940f0add
Creating a default 'in-memory' xclbin image.

Section: 'PDI'(18) was successfully added.
Size   : 568 bytes
Format : RAW
File   : 'mel_int8_cdo_combined.bin'
Successfully wrote (2090 bytes) to the output file: mel_int8_optimized.xclbin
Leaving xclbinutil.
✅ XCLBIN packaged: /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_optimized.xclbin
-rw-rw-r-- 1 ucadmin ucadmin 2.1K Oct 27 15:37 mel_int8_optimized.xclbin

Step 6: Verifying XCLBIN structure...
mel_int8_optimized.xclbin: AMD/Xilinx accelerator AXLF (xclbin) file, 2090 bytes, created Mon Oct 27 15:37:33 2025, uuid 8efec057-5fea-c4c0-41a6-d1fa34d80495, 1 sections
XRT Build Version: 2.20.0 (HEAD)
       Build Date: 2025-10-08 06:49:15
          Hash ID: 9b916190ad2865a7e7e497155c66b3b4940f0add
------------------------------------------------------------------------------
Warning: The option '--output' has not been specified. All operations will    
         be done in memory with the exception of the '--dump-section' command.
------------------------------------------------------------------------------
Reading xclbin file into memory.  File: mel_int8_optimized.xclbin

==============================================================================
XRT Build Version: 2.20.0 (HEAD)
       Build Date: 2025-10-08 06:49:15
          Hash ID: 9b916190ad2865a7e7e497155c66b3b4940f0add
==============================================================================
The BUILD_METADATA section is not present. Reports will be limited.
==============================================================================
xclbin Information
------------------
   Generated by:           <unknown>
   Version:                2.20.0

====================================================================
✅ PHASE 2.3 COMPILATION COMPLETE!
====================================================================

Generated files:
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_optimized.o (AIE2 ELF kernel)
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_lowered.mlir (lowered MLIR)
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_cdo_combined.bin (Combined CDO)
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_int8_optimized.xclbin (NPU executable)

Kernel optimizations:
  ✅ Full INT8 quantization (Q7 format)
  ✅ AIE2 SIMD vectorization (32 INT8 ops/cycle)
  ✅ Block floating-point FFT
  ✅ Vectorized mel filterbank
  ✅ Log magnitude lookup table
  ✅ Optimized memory access patterns

Expected performance: 60-80x realtime

Next: Phase 2.4 - Full pipeline integration for 220x target
====================================================================
