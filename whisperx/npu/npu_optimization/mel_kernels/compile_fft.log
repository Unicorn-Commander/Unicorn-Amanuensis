=== Phase 2.2: Compiling Mel Spectrogram Kernel with FFT ===

Step 1: Compiling C kernel to AIE2 ELF with Peano...
  Kernel: mel_fft_basic.c
  Features: FFT + Hann window + Mel filterbank

clang++: warning: treating 'c' input as 'c++' when in C++ mode, this behavior is deprecated [-Wdeprecated]
✅ C kernel compiled:
-rw-rw-r-- 1 ucadmin ucadmin 6.3K Oct 27 15:20 /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_basic.o

Step 2: Lowering MLIR (aie-opt)...
✅ MLIR lowered: /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_lowered.mlir
-rw-rw-r-- 1 ucadmin ucadmin 659 Oct 27 15:20 /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_lowered.mlir

Step 3: Generating CDO files (aie-translate)...
✅ CDO files generated:
-rw-rw-r-- 1 ucadmin ucadmin 204 Oct 27 15:20 main_aie_cdo_elfs.bin
-rw-rw-r-- 1 ucadmin ucadmin  44 Oct 27 15:20 main_aie_cdo_enable.bin
-rw-rw-r-- 1 ucadmin ucadmin 320 Oct 27 15:20 main_aie_cdo_init.bin

Step 4: Combining CDO files for XDNA...
✅ Combined CDO files: /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_cdo_combined.bin
-rw-rw-r-- 1 ucadmin ucadmin 568 Oct 27 15:20 mel_fft_cdo_combined.bin

Step 5: Packaging XCLBIN (xclbinutil)...
XRT Build Version: 2.20.0 (HEAD)
       Build Date: 2025-10-08 06:49:15
          Hash ID: 9b916190ad2865a7e7e497155c66b3b4940f0add
Creating a default 'in-memory' xclbin image.

Section: 'PDI'(18) was successfully added.
Size   : 568 bytes
Format : RAW
File   : 'mel_fft_cdo_combined.bin'
Successfully wrote (2090 bytes) to the output file: mel_fft.xclbin
Leaving xclbinutil.
✅ XCLBIN packaged: /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft.xclbin
-rw-rw-r-- 1 ucadmin ucadmin 2.1K Oct 27 15:20 mel_fft.xclbin

Step 6: Verifying XCLBIN structure...
mel_fft.xclbin: AMD/Xilinx accelerator AXLF (xclbin) file, 2090 bytes, created Mon Oct 27 15:20:13 2025, uuid c41c331b-94ba-3b66-591a-7e186866b445, 1 sections
XRT Build Version: 2.20.0 (HEAD)
       Build Date: 2025-10-08 06:49:15
          Hash ID: 9b916190ad2865a7e7e497155c66b3b4940f0add
------------------------------------------------------------------------------
Warning: The option '--output' has not been specified. All operations will    
         be done in memory with the exception of the '--dump-section' command.
------------------------------------------------------------------------------
Reading xclbin file into memory.  File: mel_fft.xclbin

==============================================================================
XRT Build Version: 2.20.0 (HEAD)
       Build Date: 2025-10-08 06:49:15
          Hash ID: 9b916190ad2865a7e7e497155c66b3b4940f0add
==============================================================================
The BUILD_METADATA section is not present. Reports will be limited.
==============================================================================
xclbin Information
------------------
   Generated by:           <unknown>
   Version:                2.20.0

====================================================================
✅ PHASE 2.2 COMPILATION COMPLETE!
====================================================================

Generated files:
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_basic.o (AIE2 ELF kernel)
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_lowered.mlir (lowered MLIR)
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft_cdo_combined.bin (Combined CDO)
  - /home/ucadmin/UC-1/Unicorn-Amanuensis/whisperx/npu/npu_optimization/mel_kernels/build/mel_fft.xclbin (NPU executable)

Kernel capabilities:
  ✅ Hann window application
  ✅ 512-point FFT (Cooley-Tukey radix-2)
  ✅ Magnitude spectrum computation
  ✅ Mel filterbank (80 bins)

Next: Test on NPU hardware to measure performance
====================================================================
